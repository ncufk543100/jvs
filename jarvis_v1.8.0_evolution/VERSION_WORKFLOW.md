# 贾维斯版本管理与同步工作流程

## 📋 核心原则

### 肆爷的铁律
1. **每改必同步**：每修改一个功能必须立即同步到 GitHub main 分支
2. **不允许延时**：严禁批量提交，必须即时同步
3. **版本即记录**：每次同步必须更新版本号和相关文档

## 🔢 版本号规则

### 百进制规则
- **格式**：`x.y.z`
- **范围**：`1.0.0` 到 `1.9.9`
- **增量**：每次更新增加 `0.0.1`

### 版本号说明
- **x（主版本号）**：重大架构变更或功能重构
- **y（次版本号）**：新功能添加或重要优化（0-9）
- **z（修订号）**：Bug修复、小优化、文档更新（0-99）

### 进位规则
```
1.0.0 → 1.0.1 → ... → 1.0.99 → 1.1.0 → ... → 1.9.99
```

当修订号达到 99 时，自动进位到次版本号，修订号归零。

## 🚀 使用方法

### 方法一：使用自动化脚本（推荐）

```bash
# 在项目根目录执行
./auto_sync.sh "功能说明"

# 示例
./auto_sync.sh "添加家庭伦理分析功能"
./auto_sync.sh "修复微信工具集成bug"
./auto_sync.sh "更新README文档"
```

脚本会自动完成：
1. ✅ 自动增加版本号
2. ✅ 更新 VERSION.json
3. ✅ 更新 README.md 中的版本号
4. ✅ 提交所有更改
5. ✅ 推送到 GitHub main 分支

### 方法二：手动操作

```bash
# 1. 修改代码
# 2. 手动更新 VERSION.json 中的版本号
# 3. 手动更新 README.md 中的版本号
# 4. 提交并推送
git add .
git commit -m "jarvis(v1.x.x): 功能说明"
git push origin main
```

## 📝 提交信息规范

### 格式
```
jarvis(v版本号): 简短说明
```

### 示例
```
jarvis(v1.55.17): 添加版本管理自动化脚本
jarvis(v1.55.18): 修复伦理分析逻辑bug
jarvis(v1.55.19): 更新项目文档
```

## 🔄 工作流程

### 标准流程
```
修改代码 → 运行 auto_sync.sh → 自动同步 → 完成
```

### 详细步骤
1. **开发阶段**：在本地修改代码、添加功能
2. **测试验证**：确保功能正常运行
3. **立即同步**：使用 `./auto_sync.sh "说明"` 立即同步
4. **验证推送**：检查 GitHub 仓库确认同步成功

## ⚠️ 注意事项

### 必须遵守
- ✅ 每个功能修改后立即执行同步
- ✅ 提交说明必须清晰描述改动内容
- ✅ 确保代码可运行后再同步
- ✅ 同步前检查 git status 确认改动内容

### 严禁操作
- ❌ 批量提交多个功能
- ❌ 延迟同步到最后一起推送
- ❌ 跳过版本号更新
- ❌ 使用模糊的提交说明

## 📊 版本历史追踪

所有版本变更记录在 `VERSION.json` 的 `changelog` 字段中，格式如下：

```json
{
  "version": "1.55.17",
  "changelog": [
    {
      "version": "1.55.17",
      "date": "2026-01-29",
      "description": "添加版本管理自动化脚本",
      "author": "jarvis"
    }
  ]
}
```

## 🛠️ 故障排查

### 推送失败
```bash
# 拉取最新代码
git pull origin main --rebase

# 重新推送
git push origin main
```

### 版本号冲突
```bash
# 手动编辑 VERSION.json 修正版本号
# 然后重新执行同步脚本
```

### 忘记同步
```bash
# 立即执行同步，不要等待
./auto_sync.sh "补充同步：之前的功能说明"
```

## 📖 相关文件

- `VERSION.json` - 版本配置文件
- `auto_sync.sh` - 自动化同步脚本
- `README.md` - 项目说明（包含版本号）
- `VERSION_WORKFLOW.md` - 本文档

---

**记住：每改必同步，即时更新，永不延时！**
